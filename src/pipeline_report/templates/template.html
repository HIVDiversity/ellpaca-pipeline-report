<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <title>{{ report_title }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/simple-datatables@latest/dist/style.css" rel="stylesheet" type="text/css">
    <script src="https://cdn.jsdelivr.net/npm/simple-datatables@latest" type="text/javascript"></script>


</head>

<body class="container">
    <header>
        <h1>Report for run {{ run_name }}</h1>
        <p><strong>Date:</strong> {{ report_date }}</p>
    </header>

    <section class="row">
        <h2>Data Attrition</h2>
        <p>This table shows the sequence count in each file before entering the pipeline (pre) and at the last stage that has un-collapsed sequences (post). You can sort the table by clicking on the columns</p>
        <table class="table" id="attrition">
            <thead>
            <tr>
                <th scope="col">File</th>
                <th scope="col">Pre Sequence Count</th>
                <th scope="col">Post Sequence Count</th>
                <th scope="col">Percent Lost</th>
                <th scope="col">Num Lost</th>
            </tr>

            </thead>
            {% for line in attrition_data %}
            <tr scope="row">
                <td>{{line.filename}}</td>
                <td>{{line.pre}}</td>
                <td>{{line.post}}</td>
                <td>{{line.pct_lost}}</td>
                <td>{{line.num_lost}}</td>
            </tr>
            {% endfor %}

        </table>

    </section>
    <section class="row">
        <h2>Filter Summary</h2>
        <p>This table summarises results from the filtering step of the pipeline. The counts represent the number
        of sequences that match the description of the heading. Note that some sequences may match two descriptions and this is not indicated.
        This table is a work in progress</p>
        <table class="table" id="filter-summary">
        <thead>
        <tr>
            <th>Sample</th>
            <th>Total Num Sequences</th>
            <th>that pass filter</th>
            <th>with more than 3 stop codons</th>
            <th>with earliest stop codon before 90</th>
            <th>with frameshifts</th>

        </tr>
        </thead>

            <tbody>
            {% for line in summary_filter_report %}
            <tr>
                <td>{{line.sample_id}}</td>
                <td>{{line.len}}</td>
                <td>{{line.passes_filter}}</td>
                <td>{{line.num_stop_codons_gt_3}}</td>
                <td>{{line.num_earliest_stop_lt_90}}</td>
                <td>{{line.contains_frameshift}}</td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </section>

<!--    <section class="row">-->
<!--        <h2>Filter Reports</h2>-->
<!--        <table class="table" id="report-table">-->
<!--            <thead>-->
<!--            <tr>-->
<!--                <th>Sample</th>-->
<!--                <th>Passed Filter</th>-->
<!--                <th>Number of Stop Codons</th>-->
<!--                <th>Earliest Stop Codon PCT</th>-->
<!--                <th>Sequence Loss</th>-->
<!--                <th>Divisible By Three</th>-->
<!--                <th>Length</th>-->
<!--            </tr>-->

<!--            {% for line in report_tables %}-->
<!--            <tr>-->
<!--                <td>{{line.sample_id}}</td>-->
<!--                <td>{{line.passes_filter}}</td>-->
<!--                <td>{{line.num_stop_codons}}</td>-->
<!--                <td>{{line.earliest_stop_pct}}</td>-->
<!--                <td>{{line.loss_from_median}}</td>-->
<!--                <td>{{line.divisible_by_three}}</td>-->
<!--                <td>{{line.length}}</td>-->
<!--            </tr>-->
<!--            {% endfor %}-->

<!--            </thead>-->
<!--        </table>-->
<!--    </section>-->


    <footer>
        <p>Report generated automatically.</p>
    </footer>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js" integrity="sha384-k6d4wzSIapyDyv1kpU366/PK5hCdSbCRGRCMv+eplOQJWyd1fbcAu9OCUj5zNLiq" crossorigin="anonymous"></script>

<script type="module">
const attr_dataTable = new simpleDatatables.DataTable("#attrition", {
	searchable: false,
	paging: false
})

const filter_dataTable = new simpleDatatables.DataTable("#filter-summary", {
	searchable: false,
	paging: false
})

</script>
</body>